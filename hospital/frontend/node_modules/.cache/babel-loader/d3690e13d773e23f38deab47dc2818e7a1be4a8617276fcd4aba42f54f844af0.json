{"ast":null,"code":"export default {\n  name: 'Appointment',\n  data() {\n    return {\n      user: null,\n      appointmentForm: {\n        departmentId: '',\n        doctorId: '',\n        appointmentDate: '',\n        appointmentTime: '',\n        symptoms: '',\n        contactPhone: ''\n      },\n      departments: [],\n      filteredDoctors: [],\n      availableTimeSlots: ['上午', '下午'],\n      rules: {},\n      submitting: false\n    };\n  },\n  created() {\n    this.loadUserInfo();\n    this.loadDepartments();\n\n    // 检查URL参数中是否有科室或医生ID\n    if (this.$route.query.departmentId) {\n      this.appointmentForm.departmentId = this.$route.query.departmentId;\n      this.handleDepartmentChange();\n    }\n    if (this.$route.query.doctorId) {\n      this.appointmentForm.doctorId = this.$route.query.doctorId;\n    }\n  },\n  methods: {\n    loadUserInfo() {\n      const userStr = localStorage.getItem('user');\n      if (userStr) {\n        this.user = JSON.parse(userStr);\n        // 设置默认联系电话\n        if (this.user.phone) {\n          this.appointmentForm.contactPhone = this.user.phone;\n        }\n      }\n    },\n    loadDepartments() {\n      this.$axios.get('/department/list').then(res => {\n        if (res.success) {\n          this.departments = res.data;\n        }\n      }).catch(err => {\n        console.error('加载科室列表失败:', err);\n        this.$message.error('加载科室列表失败');\n      });\n    },\n    handleDepartmentChange() {\n      if (this.appointmentForm.departmentId) {\n        // 清空医生选择\n        this.appointmentForm.doctorId = '';\n        // 加载该科室的医生列表\n        this.$axios.get('/doctor/list', {\n          params: {\n            departmentId: this.appointmentForm.departmentId\n          }\n        }).then(res => {\n          if (res.success) {\n            this.filteredDoctors = res.data;\n          }\n        }).catch(err => {\n          console.error('加载医生列表失败:', err);\n          this.$message.error('加载医生列表失败');\n        });\n      }\n    },\n    disabledDate(time) {\n      // 禁用日期逻辑：只能选择今天之后的日期\n      return time.getTime() < Date.now() - 8.64e7;\n    },\n    validatePhone(rule, value, callback) {\n      // 电话号码验证\n      const phoneReg = /^1[3-9]\\d{9}$/;\n      if (!value) {\n        callback(new Error('请输入联系电话'));\n      } else if (!phoneReg.test(value)) {\n        callback(new Error('请输入有效的手机号码'));\n      } else {\n        callback();\n      }\n    },\n    submitForm() {\n      this.$refs.appointmentFormRef.validate(valid => {\n        if (valid) {\n          this.submitting = true;\n          // 准备提交数据\n          const submitData = {\n            ...this.appointmentForm,\n            userId: this.user.id\n          };\n          this.$axios.post('/appointment/create', submitData).then(res => {\n            if (res.success) {\n              this.$message.success('预约成功！');\n              this.resetForm();\n              // 跳转到预约列表页\n              this.$router.push('/appointment-list');\n            } else {\n              this.$message.error(res.message || '预约失败');\n            }\n          }).catch(err => {\n            console.error('预约提交失败:', err);\n            this.$message.error('预约提交失败，请重试');\n          }).finally(() => {\n            this.submitting = false;\n          });\n        }\n      });\n    },\n    resetForm() {\n      this.$refs.appointmentFormRef.resetFields();\n      this.appointmentForm.doctorId = '';\n      // 保留联系电话\n      if (this.user && this.user.phone) {\n        this.appointmentForm.contactPhone = this.user.phone;\n      }\n    },\n    handleLogout() {\n      this.$confirm('确定要退出登录吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        this.user = null;\n        this.$router.push('/login');\n        this.$message.success('退出登录成功');\n      }).catch(() => {\n        // 取消退出\n      });\n    }\n  }\n};","map":{"version":3,"names":["name","data","user","appointmentForm","departmentId","doctorId","appointmentDate","appointmentTime","symptoms","contactPhone","departments","filteredDoctors","availableTimeSlots","rules","submitting","created","loadUserInfo","loadDepartments","$route","query","handleDepartmentChange","methods","userStr","localStorage","getItem","JSON","parse","phone","$axios","get","then","res","success","catch","err","console","error","$message","params","disabledDate","time","getTime","Date","now","validatePhone","rule","value","callback","phoneReg","Error","test","submitForm","$refs","appointmentFormRef","validate","valid","submitData","userId","id","post","resetForm","$router","push","message","finally","resetFields","handleLogout","$confirm","confirmButtonText","cancelButtonText","type","removeItem"],"sources":["src/views/Appointment.vue"],"sourcesContent":["<template>\n  <div class=\"appointment-container\">\n    <!-- 顶部导航栏 -->\n    <header class=\"header\">\n      <div class=\"header-content\">\n        <div class=\"logo\">\n          <i class=\"el-icon-medal-1\"></i>\n          <span>医院预约系统</span>\n        </div>\n        <nav class=\"nav-menu\">\n          <router-link to=\"/home\" class=\"nav-item\">首页</router-link>\n          <router-link to=\"/departments\" class=\"nav-item\">科室介绍</router-link>\n          <router-link to=\"/doctors\" class=\"nav-item\">医生团队</router-link>\n          <router-link to=\"/medical-guide\" class=\"nav-item\">医疗导诊</router-link>\n        </nav>\n        <div class=\"user-info\">\n          <div v-if=\"user\" class=\"logged-in\">\n            <span class=\"welcome\">欢迎，{{ user.name || user.username }}</span>\n            <router-link to=\"/user-info\" class=\"btn-text\">个人信息</router-link>\n            <button class=\"btn-text\" @click=\"handleLogout\">退出登录</button>\n          </div>\n          <div v-else class=\"not-logged-in\">\n            <router-link to=\"/login\" class=\"btn-primary\">登录</router-link>\n            <router-link to=\"/register\" class=\"btn-text\">注册</router-link>\n          </div>\n        </div>\n      </div>\n    </header>\n    <!-- 内容区域 -->\n    <main class=\"main-content\">\n      <div v-if=\"!user\">\n        <el-alert\n          title=\"请先登录\"\n          description=\"预约功能需要登录后使用，请先登录账号\"\n          type=\"info\"\n          show-icon\n          :closable=\"false\"\n        >\n          <router-link to=\"/login\" slot=\"after-close\">立即登录</router-link>\n        </el-alert>\n      </div>\n      <div v-else>\n        <div class=\"page-header\">\n          <h1>在线预约</h1>\n          <p class=\"page-desc\">选择合适的医生和时间进行预约</p>\n        </div>\n        <!-- 预约表单 -->\n        <el-form :model=\"appointmentForm\" :rules=\"rules\" ref=\"appointmentFormRef\" label-width=\"120px\" class=\"appointment-form\">\n          <el-form-item label=\"选择科室\" prop=\"departmentId\">\n            <el-select v-model=\"appointmentForm.departmentId\" placeholder=\"请选择科室\" @change=\"handleDepartmentChange\">\n              <el-option\n                v-for=\"dept in departments\"\n                :key=\"dept.id\"\n                :label=\"dept.name\"\n                :value=\"dept.id\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"选择医生\" prop=\"doctorId\">\n            <el-select v-model=\"appointmentForm.doctorId\" placeholder=\"请先选择科室\">\n              <el-option\n                v-for=\"doctor in filteredDoctors\"\n                :key=\"doctor.id\"\n                :label=\"doctor.name + ' - ' + doctor.title\"\n                :value=\"doctor.id\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"预约日期\" prop=\"appointmentDate\">\n            <el-date-picker\n              v-model=\"appointmentForm.appointmentDate\"\n              type=\"date\"\n              placeholder=\"请选择预约日期\"\n              format=\"yyyy-MM-dd\"\n              :disabled-date=\"disabledDate\"\n            ></el-date-picker>\n          </el-form-item>\n          <el-form-item label=\"预约时段\" prop=\"appointmentTime\">\n            <el-select v-model=\"appointmentForm.appointmentTime\" placeholder=\"请选择预约时段\">\n              <el-option\n                v-for=\"timeSlot in availableTimeSlots\"\n                :key=\"timeSlot\"\n                :label=\"timeSlot\"\n                :value=\"timeSlot\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"症状描述\" prop=\"symptoms\">\n            <el-input\n              v-model=\"appointmentForm.symptoms\"\n              type=\"textarea\"\n              :rows=\"4\"\n              placeholder=\"请简要描述您的症状或就诊需求\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item label=\"联系电话\" prop=\"contactPhone\"\n            :rules=\"[{ required: true, message: '请输入联系电话', trigger: 'blur' }, { validator: validatePhone, trigger: 'blur' }]\"\n          >\n            <el-input v-model=\"appointmentForm.contactPhone\" placeholder=\"请输入联系电话\"></el-input>\n          </el-form-item>\n          <el-form-item class=\"submit-section\">\n            <el-button type=\"primary\" @click=\"submitForm\" :loading=\"submitting\">提交预约</el-button>\n            <el-button @click=\"resetForm\">重置表单</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'Appointment',\n  data() {\n    return {\n      user: null,\n      appointmentForm: {\n        departmentId: '',\n        doctorId: '',\n        appointmentDate: '',\n        appointmentTime: '',\n        symptoms: '',\n        contactPhone: ''\n      },\n      departments: [],\n      filteredDoctors: [],\n      availableTimeSlots: ['上午', '下午'],\n      rules: {},\n      submitting: false\n    }\n  },\n  created() {\n    this.loadUserInfo()\n    this.loadDepartments()\n    \n    // 检查URL参数中是否有科室或医生ID\n    if (this.$route.query.departmentId) {\n      this.appointmentForm.departmentId = this.$route.query.departmentId\n      this.handleDepartmentChange()\n    }\n    if (this.$route.query.doctorId) {\n      this.appointmentForm.doctorId = this.$route.query.doctorId\n    }\n  },\n  methods: {\n    loadUserInfo() {\n      const userStr = localStorage.getItem('user')\n      if (userStr) {\n        this.user = JSON.parse(userStr)\n        // 设置默认联系电话\n        if (this.user.phone) {\n          this.appointmentForm.contactPhone = this.user.phone\n        }\n      }\n    },\n    loadDepartments() {\n      this.$axios.get('/department/list').then(res => {\n        if (res.success) {\n          this.departments = res.data\n        }\n      }).catch(err => {\n        console.error('加载科室列表失败:', err)\n        this.$message.error('加载科室列表失败')\n      })\n    },\n    handleDepartmentChange() {\n      if (this.appointmentForm.departmentId) {\n        // 清空医生选择\n        this.appointmentForm.doctorId = ''\n        // 加载该科室的医生列表\n        this.$axios.get('/doctor/list', { \n          params: { departmentId: this.appointmentForm.departmentId } \n        }).then(res => {\n          if (res.success) {\n            this.filteredDoctors = res.data\n          }\n        }).catch(err => {\n          console.error('加载医生列表失败:', err)\n          this.$message.error('加载医生列表失败')\n        })\n      }\n    },\n    disabledDate(time) {\n      // 禁用日期逻辑：只能选择今天之后的日期\n      return time.getTime() < Date.now() - 8.64e7\n    },\n    validatePhone(rule, value, callback) {\n      // 电话号码验证\n      const phoneReg = /^1[3-9]\\d{9}$/\n      if (!value) {\n        callback(new Error('请输入联系电话'))\n      } else if (!phoneReg.test(value)) {\n        callback(new Error('请输入有效的手机号码'))\n      } else {\n        callback()\n      }\n    },\n    submitForm() {\n      this.$refs.appointmentFormRef.validate((valid) => {\n        if (valid) {\n          this.submitting = true\n          // 准备提交数据\n          const submitData = {\n            ...this.appointmentForm,\n            userId: this.user.id\n          }\n          \n          this.$axios.post('/appointment/create', submitData).then(res => {\n            if (res.success) {\n              this.$message.success('预约成功！')\n              this.resetForm()\n              // 跳转到预约列表页\n              this.$router.push('/appointment-list')\n            } else {\n              this.$message.error(res.message || '预约失败')\n            }\n          }).catch(err => {\n            console.error('预约提交失败:', err)\n            this.$message.error('预约提交失败，请重试')\n          }).finally(() => {\n            this.submitting = false\n          })\n        }\n      })\n    },\n    resetForm() {\n      this.$refs.appointmentFormRef.resetFields()\n      this.appointmentForm.doctorId = ''\n      // 保留联系电话\n      if (this.user && this.user.phone) {\n        this.appointmentForm.contactPhone = this.user.phone\n      }\n    },\n    handleLogout() {\n      this.$confirm('确定要退出登录吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        localStorage.removeItem('token')\n        localStorage.removeItem('user')\n        this.user = null\n        this.$router.push('/login')\n        this.$message.success('退出登录成功')\n      }).catch(() => {\n        // 取消退出\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.appointment-container {\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n}\n\n/* 样式内容 */\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}