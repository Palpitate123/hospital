{"ast":null,"code":"export default {\n  name: 'UserInfo',\n  data() {\n    return {\n      user: null,\n      userForm: {\n        username: '',\n        name: '',\n        phone: '',\n        gender: 'male',\n        email: '',\n        idCard: '',\n        birthDate: '',\n        title: '',\n        specialty: '',\n        introduction: ''\n      },\n      userAvatar: '',\n      departmentName: '',\n      loading: false,\n      rules: {\n        name: [{\n          required: true,\n          message: '请输入姓名',\n          trigger: 'blur'\n        }],\n        phone: [{\n          required: true,\n          message: '请输入手机号',\n          trigger: 'blur'\n        }, {\n          pattern: /^1[3-9]\\d{9}$/,\n          message: '请输入正确的手机号格式',\n          trigger: 'blur'\n        }],\n        email: [{\n          pattern: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/,\n          message: '请输入正确的邮箱格式',\n          trigger: 'blur'\n        }],\n        idCard: [{\n          pattern: /^\\d{17}[\\dXx]$/,\n          message: '请输入正确的身份证号格式',\n          trigger: 'blur'\n        }],\n        title: [{\n          required: this.user && this.user.role === 'DOCTOR',\n          message: '请输入职称',\n          trigger: 'blur'\n        }],\n        specialty: [{\n          required: this.user && this.user.role === 'DOCTOR',\n          message: '请输入专长',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: {\n    userRoleText() {\n      if (!this.user) return '';\n      switch (this.user.role) {\n        case 'PATIENT':\n          return '患者';\n        case 'DOCTOR':\n          return '医生';\n        case 'ADMIN':\n          return '管理员';\n        default:\n          return '';\n      }\n    }\n  },\n  created() {\n    this.loadUserInfo();\n  },\n  methods: {\n    loadUserInfo() {\n      // 从本地存储获取用户信息\n      const userStr = localStorage.getItem('user');\n      if (userStr) {\n        this.user = JSON.parse(userStr);\n\n        // 获取详细的用户信息\n        this.$axios.get('/user/info').then(res => {\n          if (res.success) {\n            const userData = res.data;\n            // 更新表单数据\n            this.userForm = {\n              username: userData.username || '',\n              name: userData.name || '',\n              phone: userData.phone || '',\n              gender: userData.gender || 'male',\n              email: userData.email || '',\n              idCard: userData.idCard || '',\n              birthDate: userData.birthDate || '',\n              title: userData.title || '',\n              specialty: userData.specialty || '',\n              introduction: userData.introduction || ''\n            };\n\n            // 如果是医生，获取科室信息\n            if (this.user.role === 'DOCTOR' && userData.department) {\n              this.departmentName = userData.department.name;\n            }\n\n            // 设置头像\n            this.userAvatar = userData.avatar || '';\n          }\n        });\n      } else {\n        // 未登录，跳转到登录页\n        this.$router.push('/login');\n      }\n    },\n    handleUpdate() {\n      this.$refs.userForm.validate(valid => {\n        if (valid) {\n          this.loading = true;\n          this.$axios.put('user/update', this.userForm).then(res => {\n            if (res.success) {\n              // 更新本地存储的用户信息\n              const updatedUser = {\n                ...this.user,\n                ...this.userForm\n              };\n              localStorage.setItem('user', JSON.stringify(updatedUser));\n              this.$message.success('信息更新成功');\n            } else {\n              this.$message.error(res.message || '更新失败');\n            }\n          }).catch(err => {\n            this.$message.error('更新失败，请稍后重试');\n            console.error('更新用户信息失败:', err);\n          }).finally(() => {\n            this.loading = false;\n          });\n        }\n      });\n    },\n    handleCancel() {\n      // 重置表单\n      this.loadUserInfo();\n    }\n  }\n};","map":{"version":3,"names":["name","data","user","userForm","username","phone","gender","email","idCard","birthDate","title","specialty","introduction","userAvatar","departmentName","loading","rules","required","message","trigger","pattern","role","computed","userRoleText","created","loadUserInfo","methods","userStr","localStorage","getItem","JSON","parse","$axios","get","then","res","success","userData","department","avatar","$router","push","handleUpdate","$refs","validate","valid","put","updatedUser","setItem","stringify","$message","error","catch","err","console","finally","handleCancel"],"sources":["src/views/UserInfo.vue"],"sourcesContent":["<template>\n  <div class=\"user-info-container\">\n    <!-- 侧边导航栏 --<\n    <div class=\"sidebar\">\n      <div class=\"user-avatar\">\n        <el-avatar :size=\"100\" :src=\"userAvatar\" icon=\"el-icon-user-solid\"></el-avatar>\n      </div>\n      <h3 class=\"user-name\">{{ user.name || user.username }}</h3>\n      <p class=\"user-role\">{{ userRoleText }}</p>\n      <nav class=\"sidebar-menu\">\n        <div class=\"menu-item active\">\n          <i class=\"el-icon-info\"></i>\n          <span>基本信息</span>\n        </div>\n        <div class=\"menu-item\">\n          <i class=\"el-icon-lock\"></i>\n          <span>修改密码</span>\n        </div>\n        <router-link to=\"/appointment-list\" class=\"menu-item\">\n          <i class=\"el-icon-document\"></i>\n          <span>预约记录</span>\n        </router-link>\n      </nav>\n    </div>\n    <!-- 主内容区域 -->\n    <div class=\"main-content\">\n      <div class=\"content-header\">\n        <h2>个人信息管理</h2>\n      </div>\n      <div class=\"content-body\">\n        <!-- 基本信息表单 -->\n        <el-form ref=\"userForm\" :model=\"userForm\" :rules=\"rules\" label-width=\"120px\">\n          <el-form-item label=\"用户名\">\n            <el-input v-model=\"userForm.username\" disabled></el-input>\n          </el-form-item>\n          <el-form-item label=\"姓名\" prop=\"name\">\n            <el-input v-model=\"userForm.name\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"手机号\" prop=\"phone\">\n            <el-input v-model=\"userForm.phone\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"性别\">\n            <el-radio-group v-model=\"userForm.gender\">\n              <el-radio label=\"male\">男</el-radio>\n              <el-radio label=\"female\">女</el-radio>\n            </el-radio-group>\n          </el-form-item>\n          <el-form-item label=\"邮箱\" prop=\"email\">\n            <el-input v-model=\"userForm.email\" type=\"email\"></el-input>\n          </el-form-item>\n          <!-- 患者特有信息 -->\n          <div v-if=\"user.role === 'PATIENT'\">\n            <el-form-item label=\"身份证号\" prop=\"idCard\">\n              <el-input v-model=\"userForm.idCard\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"出生日期\" prop=\"birthDate\">\n              <el-date-picker v-model=\"userForm.birthDate\" type=\"date\" placeholder=\"选择日期\" style=\"width: 100%;\"></el-date-picker>\n            </el-form-item>\n          </div>\n          <!-- 医生特有信息 -->\n          <div v-if=\"user.role === 'DOCTOR'\">\n            <el-form-item label=\"科室\">\n              <el-input v-model=\"departmentName\" disabled></el-input>\n            </el-form-item>\n            <el-form-item label=\"职称\" prop=\"title\">\n              <el-input v-model=\"userForm.title\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"专长\" prop=\"specialty\">\n              <el-input v-model=\"userForm.specialty\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"简介\" prop=\"introduction\">\n              <el-input v-model=\"userForm.introduction\" type=\"textarea\" rows=\"4\"></el-input>\n            </el-form-item>\n          </div>\n          <el-form-item>\n            <el-button type=\"primary\" @click=\"handleUpdate\" :loading=\"loading\">保存修改</el-button>\n            <el-button @click=\"handleCancel\">取消</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'UserInfo',\n  data() {\n    return {\n      user: null,\n      userForm: {\n        username: '',\n        name: '',\n        phone: '',\n        gender: 'male',\n        email: '',\n        idCard: '',\n        birthDate: '',\n        title: '',\n        specialty: '',\n        introduction: ''\n      },\n      userAvatar: '',\n      departmentName: '',\n      loading: false,\n      rules: {\n        name: [\n          { required: true, message: '请输入姓名', trigger: 'blur' }\n        ],\n        phone: [\n          { required: true, message: '请输入手机号', trigger: 'blur' },\n          { pattern: /^1[3-9]\\d{9}$/, message: '请输入正确的手机号格式', trigger: 'blur' }\n        ],\n        email: [\n          { pattern: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/, message: '请输入正确的邮箱格式', trigger: 'blur' }\n        ],\n        idCard: [\n          { pattern: /^\\d{17}[\\dXx]$/, message: '请输入正确的身份证号格式', trigger: 'blur' }\n        ],\n        title: [\n          { required: this.user && this.user.role === 'DOCTOR', message: '请输入职称', trigger: 'blur' }\n        ],\n        specialty: [\n          { required: this.user && this.user.role === 'DOCTOR', message: '请输入专长', trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  computed: {\n    userRoleText() {\n      if (!this.user) return ''\n      switch (this.user.role) {\n        case 'PATIENT':\n          return '患者'\n        case 'DOCTOR':\n          return '医生'\n        case 'ADMIN':\n          return '管理员'\n        default:\n          return ''\n      }\n    }\n  },\n  created() {\n    this.loadUserInfo()\n  },\n  methods: {\n    loadUserInfo() {\n      // 从本地存储获取用户信息\n      const userStr = localStorage.getItem('user')\n      if (userStr) {\n        this.user = JSON.parse(userStr)\n        \n        // 获取详细的用户信息\n        this.$axios.get('/user/info').then(res => {\n          if (res.success) {\n            const userData = res.data\n            // 更新表单数据\n            this.userForm = {\n              username: userData.username || '',\n              name: userData.name || '',\n              phone: userData.phone || '',\n              gender: userData.gender || 'male',\n              email: userData.email || '',\n              idCard: userData.idCard || '',\n              birthDate: userData.birthDate || '',\n              title: userData.title || '',\n              specialty: userData.specialty || '',\n              introduction: userData.introduction || ''\n            }\n            \n            // 如果是医生，获取科室信息\n            if (this.user.role === 'DOCTOR' && userData.department) {\n              this.departmentName = userData.department.name\n            }\n            \n            // 设置头像\n            this.userAvatar = userData.avatar || ''\n          }\n        })\n      } else {\n        // 未登录，跳转到登录页\n        this.$router.push('/login')\n      }\n    },\n    handleUpdate() {\n      this.$refs.userForm.validate((valid) => {\n        if (valid) {\n          this.loading = true\n          \n          this.$axios.put('user/update', this.userForm).then(res => {\n            if (res.success) {\n              // 更新本地存储的用户信息\n              const updatedUser = { ...this.user, ...this.userForm }\n              localStorage.setItem('user', JSON.stringify(updatedUser))\n              \n              this.$message.success('信息更新成功')\n            } else {\n              this.$message.error(res.message || '更新失败')\n            }\n          }).catch(err => {\n            this.$message.error('更新失败，请稍后重试')\n            console.error('更新用户信息失败:', err)\n          }).finally(() => {\n            this.loading = false\n          })\n        }\n      })\n    },\n    handleCancel() {\n      // 重置表单\n      this.loadUserInfo()\n    }\n  }\n}\n</script>\n\n<style scoped>\n.user-info-container {\n  min-height: calc(100vh - 60px);\n  display: flex;\n  background-color: #f5f7fa;\n}\n\n/* 侧边栏样式 */\n.sidebar {\n  width: 260px;\n  background-color: #fff;\n  padding: 30px 20px;\n  box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);\n}\n\n.user-avatar {\n  text-align: center;\n  margin-bottom: 20px;\n}\n\n.user-name {\n  text-align: center;\n  font-size: 18px;\n  font-weight: bold;\n  margin-bottom: 5px;\n  color: #303133;\n}\n\n.user-role {\n  text-align: center;\n  color: #606266;\n  margin-bottom: 30px;\n}\n\n.sidebar-menu .menu-item {\n  display: flex;\n  align-items: center;\n  padding: 12px 20px;\n  margin-bottom: 10px;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.3s;\n  color: #606266;\n}\n\n.sidebar-menu .menu-item:hover {\n  background-color: #ecf5ff;\n  color: #1890ff;\n}\n\n.sidebar-menu .menu-item.active {\n  background-color: #ecf5ff;\n  color: #1890ff;\n  font-weight: bold;\n}\n\n.sidebar-menu .menu-item i {\n  margin-right: 10px;\n  font-size: 16px;\n}\n\n/* 主内容区域 */\n.main-content {\n  flex: 1;\n  padding: 30px;\n}\n\n.content-header {\n  margin-bottom: 30px;\n}\n\n.content-header h2 {\n  font-size: 24px;\n  color: #303133;\n  margin: 0;\n}\n\n.content-body {\n  background-color: #fff;\n  border-radius: 8px;\n  padding: 30px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n/* 表单样式 */\n.el-form {\n  max-width: 600px;\n}\n\n.el-form-item {\n  margin-bottom: 25px;\n}\n\n.el-button {\n  margin-right: 15px;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .user-info-container {\n    flex-direction: column;\n  }\n  \n  .sidebar {\n    width: 100%;\n    padding: 20px;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n  \n  .sidebar-menu {\n    display: flex;\n    overflow-x: auto;\n  }\n  \n  .sidebar-menu .menu-item {\n    margin-right: 10px;\n    white-space: nowrap;\n  }\n  \n  .main-content {\n    padding: 20px;\n  }\n  \n  .content-body {\n    padding: 20px;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}